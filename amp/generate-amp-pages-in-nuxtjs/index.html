<!doctype html>
<html ⚡>
  <head>
    <title>Membuat AMP Pages dengan Nuxt.js</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Irfan Maulana"><meta name="keywords" content="mazipan, mazipanneh, irfan maulana, irfan vue, irfan blibli, irfan bizzy"><meta name="theme-color" content="#bd93f9"><meta name="mobile-web-app-capable" content="yes"><meta property="og:image" content="https://www.mazipan.xyz/icon.png"><meta property="og:image:secure_url" content="https://www.mazipan.xyz/icon.png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta property="og:site_name" content="@mazipan"><meta property="profile:username" content="mazipanneh"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@maz_ipan"><meta name="twitter:site" content="@maz_ipan"><meta name="twitter:image:src" content="https://www.mazipan.xyz/icon.png"><meta name="description" content="Menceritakan bagaimana cara membuat AMP Pages untuk blog kalian dengan framework Nuxt.js"><meta name="apple-mobile-web-app-title" content="Membuat AMP Pages dengan Nuxt.js"><meta property="og:title" content="Membuat AMP Pages dengan Nuxt.js"><meta property="og:description" content="Menceritakan bagaimana cara membuat AMP Pages untuk blog kalian dengan framework Nuxt.js"><meta property="og:url" content="https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs/"><meta property="og:type" content="article"><meta property="article:published_time" content="2019-06-02T00:00:00.000Z"><meta property="article:section" content="Technology"><meta name="twitter:title" content="Membuat AMP Pages dengan Nuxt.js"><meta name="twitter:description" content="Menceritakan bagaimana cara membuat AMP Pages untuk blog kalian dengan framework Nuxt.js"><meta name="twitter:url" content="https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs/"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png"><link rel="manifest" href="/_nuxt/manifest.c9c59db4.json"><link rel="shortcut icon" href="/_nuxt/icons/icon_64.b338d5.png"><link rel="apple-touch-icon" href="/_nuxt/icons/icon_512.b338d5.png" sizes="512x512"><link rel="canonical" href="https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs/">
    
  <style amp-custom>/*! modern-normalize | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-box-sizing:border-box;box-sizing:border-box}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}hr{height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{padding:0}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}:root{--bg:#282a36;--bgLighter:#44475a;--textNormal:#f8f8f2;--textTitle:#50fa7b;--textSubtitle:#8be9fd;--textLink:#bd93f9;--textHighlight:#ff79c6;--textWarning:#f1fa8c;--textDanger:#ff5555;--textSecondary:#6272a4}body{font-family:'Merriweather Sans',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:16px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box;color:var(--textNormal);background-color:var(--bg)}.container{margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem}.clearfix::after{content:"";clear:both;display:table}a{color:var(--textLink);text-decoration:none}a:hover{text-decoration:underline}blockquote{font-style:italic;border-left:4px solid var(--textSecondary);color:var(--textSecondary);margin:0;padding:.25em 1em;font-size:110%}small{font-size:80%}table{display:block;overflow:auto;width:100%;border-collapse:collapse;border-spacing:0}table th{border:1px solid #dfe2e5;padding:13px;font-weight:600}table tr td{border:1px solid #c6cbd1;padding:8px 13px;text-align:left}table tr:nth-child(2n){background-color:#3c3e50}:not(pre)>code[class*=language-],pre[class*=language-]{border-radius:10px;-webkit-box-shadow:0 0 8px 4px rgba(0,0,0,.2);box-shadow:0 0 8px 4px rgba(0,0,0,.2);background-color:var(--bgLighter)}code:not([class*=language-]){background-color:var(--bgLighter);color:var(--textLink);padding:.1em .5em;border-radius:.25em}pre{max-width:100%;overflow:auto}.flex{display:-webkit-box;display:-ms-flexbox;display:flex}.flex--center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.dot{padding:0 .5em}.wrapper{margin:1em 0 0 0;min-height:60vh}.meta{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.meta__date{color:var(--textSubtitle)}@media screen and (max-width:640px){.meta--desktop{display:none}}.meta--mobile{display:none}@media screen and (max-width:640px){.meta--mobile{display:block}}.space-bottom{margin-bottom:1em}.footer{width:100%;margin:0 auto;text-align:center}@-webkit-keyframes zoomIn{from{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes zoomIn{from{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}50%{opacity:1}}.zoomIn{-webkit-animation-name:zoomIn;animation-name:zoomIn;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.text-normal{color:var(--textNormal)}.text-title{color:var(--textTitle)}.text-subtitle{color:var(--textSubtitle)}.text-link{color:var(--textLink)}.text-highlight{color:var(--textHighlight)}.text-warning{color:var(--textWarning)}.text-danger{color:var(--textDanger)}.text-secondary{color:var(--textSecondary)}.header{margin-bottom:3.5rem}.header--simplify{margin-bottom:1rem}.profile{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.profile--left{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.profile__img{height:76px;width:76px;margin-right:1em}.profile__text{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;margin-right:1em}.profile__title{font-size:1.5em;margin-top:0}.profile__social a{margin-right:.5em}.navigation{margin-top:1em}.pages__title{margin-bottom:.25em}.pages__title--small{font-size:2em}.pages__content{width:100%;word-break:break-word;margin:2em 0}.pages__date{color:var(--textSubtitle)}.pages__item{margin-bottom:3.5em}.pages__lang{padding:.25em 1em;border-radius:.25em;background-color:var(--bgLighter);margin-bottom:1em;display:table;cursor:pointer}.pages__tags{display:-webkit-box;display:-ms-flexbox;display:flex}.pages__tags--spacetop{margin-top:.5em}.pages__tag{margin-right:.5em;padding:0 .5em;line-height:1.5;border-radius:.25em}.pages__tag a{color:var(--bgLighter)}.pages__tag:first-child{background-color:var(--textHighlight)}.pages__tag:nth-child(2){background-color:var(--textTitle)}.pages__tag:nth-child(3){background-color:var(--textSubtitle)}.pages__sponsored{padding:.25em 1em;border-radius:.25em;background-color:var(--bgLighter)}.pages__footer{margin:1em 0}.block-wrap{margin:1em 0;display:-webkit-box;display:-ms-flexbox;display:flex;justify-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.like,.share{display:-webkit-box;display:-ms-flexbox;display:flex}.like-btn,.share-btn{color:var(--textNormal);background:var(--textLink);padding:.25em 1em;border-radius:.25em;border:0;outline:0;cursor:pointer;margin-right:1em;text-decoration:none;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.pages__content h2{color:var(--textSubtitle)}.pages__content h3{color:var(--textWarning)}.pages__content a{color:var(--textHighlight);text-decoration:underline}.pages__content p{line-height:1.5}.pages__content img{width:90%;height:auto;border-radius:10px;-webkit-box-shadow:1px 1px 8px 5px rgba(0,0,0,.2);box-shadow:1px 1px 8px 5px rgba(0,0,0,.2)}.pages__content ol>li,.pages__content ul{line-height:2}.ion{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.ion__svg{fill:currentColor}@-webkit-keyframes ionShake{10%,90%{-webkit-transform:translate3d(-1px,0,0);transform:translate3d(-1px,0,0)}20%,80%{-webkit-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0)}30%,50%,70%{-webkit-transform:translate3d(-4px,0,0);transform:translate3d(-4px,0,0)}40%,60%{-webkit-transform:translate3d(4px,0,0);transform:translate3d(4px,0,0)}}@keyframes ionShake{10%,90%{-webkit-transform:translate3d(-1px,0,0);transform:translate3d(-1px,0,0)}20%,80%{-webkit-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0)}30%,50%,70%{-webkit-transform:translate3d(-4px,0,0);transform:translate3d(-4px,0,0)}40%,60%{-webkit-transform:translate3d(4px,0,0);transform:translate3d(4px,0,0)}}@-webkit-keyframes ionRotate{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes ionRotate{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes ionBeat{0%{-webkit-transform:scale(.75);transform:scale(.75)}20%{-webkit-transform:scale(1);transform:scale(1)}40%{-webkit-transform:scale(.75);transform:scale(.75)}60%{-webkit-transform:scale(1);transform:scale(1)}80%{-webkit-transform:scale(.75);transform:scale(.75)}100%{-webkit-transform:scale(.75);transform:scale(.75)}}@keyframes ionBeat{0%{-webkit-transform:scale(.75);transform:scale(.75)}20%{-webkit-transform:scale(1);transform:scale(1)}40%{-webkit-transform:scale(.75);transform:scale(.75)}60%{-webkit-transform:scale(1);transform:scale(1)}80%{-webkit-transform:scale(.75);transform:scale(.75)}100%{-webkit-transform:scale(.75);transform:scale(.75)}}.ion-beat{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:ionBeat;animation-name:ionBeat;-webkit-animation-duration:.82s;animation-duration:.82s}.ion-shake{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:ionShake;animation-name:ionShake;-webkit-animation-duration:.82s;animation-duration:.82s}.ion-rotate{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:ionRotate;animation-name:ionRotate;-webkit-animation-duration:2s;animation-duration:2s}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:4px;width:0%;opacity:1;-webkit-transition:width .1s,opacity .4s;transition:width .1s,opacity .4s;background-color:#bd93f9;z-index:999999}.nuxt-progress.nuxt-progress-notransition{-webkit-transition:none;transition:none}.nuxt-progress-failed{background-color:red}</style><script async src="https://cdn.ampproject.org/v0.js"></script>
<script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript></head>
  <body>
    <div id="__nuxt"><!----><div id="__layout"><div class="container app"><header class="header header--simplify clearfix"><div class="header__block"><div class="header__child"><a href="/amp/" class="nuxt-link-active"><h1 class="h1">
          mazipan.xyz
        </h1></a> <div class="nav navigation"><a href="/amp/about">
    😎 About
  </a> <span class="dot"> • </span> <a href="/amp/now">
    ⏰ Now
  </a> <span class="dot"> • </span> <a href="/amp/archives">
    📦 Archives
  </a></div></div></div></header> <section class="postdetail-ID wrapper clearfix"><section class="pages"><h1 class="pages__title pages__title--small text-title">
    Membuat AMP Pages dengan Nuxt.js
  </h1> <div class="pages__lang"><a href="/amp/generate-amp-pages-in-nuxtjs/en?utm_source=lang">
      Switch to  🇬🇧 language
    </a></div> <!----> <div><div class="meta meta--desktop"><small class="meta__date">
      📆 June 2, 2019
    </small> <small class="dot"> • </small> <small class="meta__read">☕️☕️ 20 min read</small> <!----> <!----> <!----> <!----></div> <div class="meta meta--mobile"><div><small class="meta__date">
        📆 June 2, 2019
      </small> <small class="dot"> • </small> <small class="meta__read">☕️☕️ 20 min read</small></div> <div style="margin-top:.5em"><!----> <!----> <!----></div></div></div> <div class="pages__tags pages__tags--spacetop"><div class="pages__tag"><a href="/category/javascript?utm_source=home" title="javascript">
        #javascript
      </a></div><div class="pages__tag"><a href="/category/nuxt?utm_source=home" title="nuxt">
        #nuxt
      </a></div><div class="pages__tag"><a href="/category/amp?utm_source=home" title="amp">
        #amp
      </a></div></div> <div class="pages__content"><div class="content-markdown"><h2>Sekilas Mengenai AMP</h2> <p>AMP (Accelerated Mobile Pages - <a href="https://amp.dev">amp.dev ↗️</a>) merupakan inisiatif yang diawali oleh Google dalam membantu para publisher, developer dan para pemilik website agar bisa menyediakan website dengan kecepatan muat yang sangat cepat bahkan mendekati instan untuk device mobile. Untuk mencapai titik muat instan ini tentu tidak didapatkan secara gratis, ini dilakukan dengan peraturan ketat yang diterapkan oleh AMP. Ekstremnya bisa disebut bahwa AMP bahkan tidak memperbolehkan untuk menyisipkan sembarang skrip JavaScript ke dalam halaman website kita, ditambah dengan berbagai aturan ketat lainnya yang bisa menjamin bahwa website dengan dukungan AMP yang valid bisa tetap dimuat dengan kecepatan yang luar biasa cepat.</p> <p>AMP merupakan rekomendasi yang dianjurkan oleh Google langsung karena memiliki prioritas yang baik bagi hasil pencarian Google Search. Dan dengan rampingnya teknologi di dalamnya serta ditambah bantuan <em>cache</em> dari Google membuat AMP menjadi sangat cepat diakses dan sangat baik untuk digunakan sebagai halaman pertama bagi pengunjung yang datang dari hasil Google Search ini.</p> <h2>Dasar-dasar Membuat AMP</h2> <p>Halaman AMP memang menjadi halaman yang terpisah dari halaman aslinya, ini dikarenakan terlalu banyak aturan ketat yang membuat teknologi website pada umumnya akan susah untuk membuat halaman AMP yang valid. Halaman AMP seperti ibarat halaman kopian dari halaman asli yang telah kita buat sebelumnya namun dengan memenuhi berbagai aturan yang telah ditetapkan oleh AMP.</p> <p>Untuk membuat halaman AMP pertama kita, pertama kita perlu menambahkan identifikasi pada tag <code>html</code> bahwa halaman tersebut merupakan versi AMP.</p> <p>Bila sebelumnya kita menulis html seperti berikut:</p> <pre><code class="language-html">&lt;html>
  &lt;head>&lt;/head>
  &lt;body>&lt;/body>
&lt;html>
</code></pre> <p>Maka di AMP kita akan menambahkan emoji ⚡ pada tag <code>html</code> seperti berikut:</p> <pre><code class="language-html">&lt;html ⚡>
  &lt;head>&lt;/head>
  &lt;body>&lt;/body>
&lt;html>
</code></pre> <p>Atau bila kita tidak senang menggunakan emoji bisa menggantinya dengan atribut <code>amp</code> tanpa perlu mengisi nilai apapun pada atribut tersebut.</p> <p>Setelahnya kita bisa menambahkan skrip utama untuk mendukung AMP dengan menambahkan kode berikut:</p> <pre><code class="language-html">&lt;script async src="https://cdn.ampproject.org/v0.js">&lt;/script>
</code></pre> <p>Serta menambahkan CSS wajib atau disebut <em>boilerplate</em> untuk halaman AMP berikut:</p> <pre><code class="language-html">&lt;style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}&lt;/style>&lt;noscript>&lt;style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}&lt;/style>&lt;/noscript>
</code></pre> <p>Perlu diketahui bahwa kita tidak boleh menambahkan skrip JavaScript apapun selain yang sudah dibuatkan oleh AMP sendiri atau biasa dikenal dengan komponen AMP, jadi kita diharuskan untuk menghapus semua link untuk memuat berbagai JavaScript.</p> <p>Pun dengan CSS, tidak diperbolehkan bagi kita untuk memuat eksternal CSS sehingga harus menghapus semua link yang memuat CSS dari luar. Bila kita membutuhkan CSS tambahan, kita bisa menggunakan internal CSS dengan tag <code>style</code> dengan atribut wajib yakni <code>amp-custom</code> seperti contoh berikut:</p> <pre><code class="language-html">&lt;style amp-custom>
  .custom-class {}
&lt;/style>
</code></pre> <p>Dalam menggunakan CSS pun ada hal yang perlu diperhatikan, seperti tidak bolehnya kita menggunakan <code></code>.</p> <p>Pada dasarnya kita bebas menggunakan berbagai tag HTML pada halaman AMP kita, namun dengan aturan ketat AMP yang meyarankan untuk menggunakan komponen yang telah mereka buat untuk membangun berbagai hal umum, maka ada baiknya bila kita sempatkan untuk membaca halaman dokumen resmi dari AMP mengenai komponen apa saja yang telah disediakan dan bisa kita gunakan pada halaman AMP. Selengkapnya silakan baca di halaman <a href="https://amp.dev/documentation/components/?format=websites">komponen AMP ↗️</a>.</p> <h2>Membuat AMP di Nuxt.js</h2> <p>Awalnya merupakan hal yang sangat sulit untuk membangun halaman AMP yang valid dengan menggunakan framework yang berbasiskan JavaScript, ini dikarenakan AMP sendiri melarang penggunaan JavaScript yang justru pada framework tersebut telah menjadi sebuah tulang punggung dari website kita.</p> <p>Namun dengan perkembangan framework JavaScript akhir-akhir termasuk Nuxt.js di dalamnya, hal yang tadinya tidak terfikirkan untuk dikerjakan menjadi mungkin meskipun masih tergolong rumit tertutama bagi para pengembang web pendatang baru.</p> <p>Untuk blog saya sendiri memang dibangun diatas Nuxt.js yang memanfaatkan kemampuan untuk memproduksi file statis sehingga lebih mudah bagi saya untuk menyajikan website ini. Sayangnya file statis hasil buatan Nuxt.js masih mengandung eksternal JavaScript dan CSS yang sudah kita bahas bahwa hal ini dilarang dalam sebuah halaman AMP. Jadi hal berat yang akan kita kerjakan adalah melakukan pembersihan terhadap halaman AMP yang dihasilkan oleh Nuxt.js ini.</p> <p>Berikut langkah-langkah yang saya kerjakan untuk membuat halaman AMP untuk blog saya:</p> <h3>1. Membuat halaman baru</h3> <p>Karena halaman AMP merupakan kloningan halaman aslinya maka kita perlu membuat halaman baru yang kontennya mendekati konten aslinya. Saya membuat semua halaman AMP berada dibawah satu akar URL yang sama yakni <code>/amp/**</code> agar mudah bagi saya untuk mendeteksi mana halaman asli dan mana halaman AMP.</p> <h3>2. Hapus kode yang tidak diperlukan</h3> <p>Karena di AMP nantinya kita akan menghapus semua penggunaan Javascript, maka kode-kode di bawah <code>methods</code> pada halaman AMP yang mana kebanyakan merupakan fungsi-fungsi yang mendukung interaktitas sebuah halaman website menjadi tidak diperlukan lagi. Dan karena saya juga tidak suka memelihara kode yang tidak diperlukan lagi, maka menghapus adalah pilihan terbaik yang bisa dikerjakan.</p> <h3>3. Menambahkan hook saat generate</h3> <p>Saya memanfaatkan fungsi <code>generate</code> milik Nuxt untuk memproduksi file statis blog saya, karenanya saya perlu menambahkan hook pada saat Nuxt melakukan proses ini agar hasilnya bisa saya manipulasi nantinya.</p> <p>Untuk melakukan hal diatas saya perlu menambahkan kode berikut di berkas <code>nuxt.config.js</code>:</p> <pre><code class="language-javascript">module.exports = {
  hooks: {
    'generate:page': (page) => {
      if (/^\/amp/gi.test(page.route)) {
        console.log('processing amp file: ', page.route)
      }
    }
  },
}
</code></pre> <p>Kode diatas membuat kita bisa menyelipkan sebuah proses ketika Nuxt melakukan proses <code>generate</code> dan saya menambahkan sebuah <em>RegEx</em> untuk mendeteksi hanya halaman AMP saja yang akan diselipkan proses tambahan sementara untuk halaman normal kita tidak memerlukan.</p> <h3>4. Memanipulasi HTML</h3> <p>Dari kode pada bagian sebelumnya kita mendapatkan objek <code>page</code> yang bila kita ambil property <code>page.html</code> adalah merupakan string HTML yang nantinya akan dijadikan file HTML sebagai keluaran akhir.</p> <p>Syukurnya saya menemukan artikel dari <a href="https://toor.co/blog/amp-pages-using-nuxt-js/">toor.co ↗️</a> yang dari situ kita bisa temukan dasar dari fungsi yang bisa memanipulasi HTML string agar mendukung AMP.</p> <p>Fungsinya kurang lebih seperti berikut:</p> <pre><code class="language-javascript">const ampScript = '&lt;script async src="https://cdn.ampproject.org/v0.js">&lt;/script>'
const ampBoilerplate = '&lt;style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}&lt;/style>&lt;noscript>&lt;style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}&lt;/style>&lt;/noscript>'

module.exports = (html) => {
  // Add ⚡ to html tag
  html = html.replace(/&lt;html/gi, '&lt;html ⚡')

  // Combine css into single tag
  let styleConcat = ''
  html = html.replace(/&lt;style[^>]*>]*>(.*?)?&lt;\/style>/gi, (match, sub) => {
    styleConcat += sub
    return ''
  })
  html = html.replace('&lt;/head>', `&lt;style amp-custom>${styleConcat}&lt;/style>&lt;/head>`)

  // Remove preload and prefetch tags
  html = html.replace(/&lt;link[^>]*rel="(?:preload|prefetch)?"[^>]*>/gi, '')

  // Remove amphtml tag
  html = html.replace(/&lt;link[^>]*rel="(?:amphtml)?"[^>]*>/gi, '')

  // Remove data attributes from tags
  html = html.replace(/\s*=>]*="[^"]*"|[^=>\s]*)/gi, '')

  // Remove JS script tags except for ld+json
  html = html.replace(/&lt;script\b[^&lt;]*(?:(?!&lt;\/script>)&lt;[^&lt;]*)*&lt;\/script>/gi, (match) => {
    return (/application\/ld\+json/gi.test(match)) ? match : ''
  })

  // Replace img tags with amp-img
  html = html.replace(/&lt;img([^>]*)>/gi, (match, sub) => {
    return `&lt;amp-img ${sub} layout=intrinsic>&lt;/amp-img>`
  })

  // Add AMP script before &lt;/head>
  html = html.replace('&lt;/head>', ampScript + ampBoilerplate + '&lt;/head>')

  return html
}
</code></pre> <p>Seperti kalian bisa baca di bagian komentar pada kode diatas, bahwa kode diatas melakukan berbagai proses penggantian karakter (<em>replace</em>) menggunakan <em>RegEx</em> seperti menambahkan emoji ⚡, menggabungkan semua CSS internal ke dalam satu tag <code>&lt;style amp-custom></code>, menghilangkan berbagai JavaScript eksternal, menambahkan skrip utama dan CSS boilerplate AMP serta berbagai hal lainnya.</p> <p>Fungsi ini saya letakan di direktory <code>plugins/ampify.js</code> yang kemudian dipanggil pada hook generate seperti berikut:</p> <pre><code class="language-javascript">const ampify = require('./plugins/ampify')

module.exports = {
  hooks: {
    'generate:page': (page) => {
      if (/^\/amp/gi.test(page.route)) {
        console.log('processing amp file: ', page.route)
        page.html = ampify(page.html)
      }
    }
  },
}
</code></pre> <h3>5. Mengganti semua penggunaan scoped style menjadi un-scoped</h3> <p>Karena saya termasuk cupu untuk bermain dengan <em>RegEx</em> maka mengutak-atik kode yang penuh dengan <em>RegEx</em> seperti diatas menjadi PR tersendiri.</p> <p>Walhasil ketika menyadari bahwa baris kode berikut ini:</p> <pre><code class="language-javascript">// Remove data attributes from tags
html = html.replace(/\s*=>]*="[^"]*"|[^=>\s]*)/gi, '')
</code></pre> <p>Ternyata mengakibatkan semua kode CSS <em>scoped</em> saya menjadi berantakan, maka pilihan terbaik adalah memindahkan semua <em>scoped</em> CSS kedalam CSS biasa yang bersifat global. Tentu bukan hal yang mudah karena saya sudah terbiasa dimudahkan dengan kemampuan Vue yang bisa membuat <em>scoped</em> CSS dengan sangat mudah. Pilihan menggunakan global CSS berarti memaksa saya kembali menggunakan konvensi CSS yang tetap mengedepankan prinsip <em>scoped</em> ini seperti BEM CSS.</p> <p>Langkah ini tidak perlu teman-teman ikuti bila memang teman-teman bisa melakukan modifikasi <em>RegEx</em> agar bisa melakukan penggantian karakter dengan lebih tepat tanpa menimbulkan efek samping pada CSS.</p> <h3>6. Mengganti semua lazy load gambar</h3> <p>Pada halaman non-AMP, saya memanfaatkan pustaka <a href="https://github.com/mazipan/vue-tiny-lazyload-img">VueTinyLazyloadImg ↗️</a> untuk melakukan lazy load pada setiap gambar yang dimuat. Sayangnya proses ini dikerjakan oleh JavaScript. Pada AMP hal ini tidak diperlukan lagi karena mereka memiliki komponen <code>amp-img</code> yang sudah mendukung lazy load.</p> <p>Dengan menggunakan <code>amp-img</code> maka tag HTML saya untuk gambar menjadi tidak valid karena sebelumnya dengan pustaka yang saya gunakan diatas saya meletakan alamat gambar pada atribut <code>> sementara pada atribut <code>src</code> hanya saya letakan gambar placeholder. Pilihan termudah adalah mengganti tag <code>> menjadi tag <code>src</code> dan menghapus penempatan gambar placeholder pada atribut <code>src</code>.</p> <p>Proses diatas bisa kita letakkan pada fungsi sebelumnya yang kita gunakan untuk melakukan penggantian karakter pada HTML string. Sebagai catatan bahwa kita perlu meletakan proses ini sebeleum penghilangan berbagai atribut <code>> yang ada di dalam fungsi tersebut karena kita akan kehilangan atribut <code>> bila dilakukan setelahnya.</p> <p>Sementara untuk saat ini, saya memilih meletakan pada file .vue yang menjadi halaman AMP dimana disini dilakukan proses parsing konten <em>Markdown</em> menggunakan <code>frontmatter-markdown-loader</code>.</p> <p>Fungsi yang saya buat seperti berikut:</p> <pre><code class="language-javascript">function replaceLazyloadImg (str) {
  return str && str.replace(/"src":(?:[^=>][^"]*","=>"]*)/gi, '"src"')
}
</code></pre> <h3>7. Menambahkan ukuran pada gambar</h3> <p>Ini pekerjaan yang sampai artikel ini dipublikasikan masih belum sempat saya selesaikan. Menambahkan atribut <code>height</code> dan <code>width</code> pada konten Markdown yang menyertakan gambar di dalamnya.</p> <h3>8. Menambahkan canonical</h3> <p>Kita perlu menautkan antara halaman AMP dengan halaman aslinya agar bisa dideteksi oleh Google bahwa halaman AMP tersebut merupakan representasi dari konten yang mana.</p> <p>Caranya adalah dengan menambahkan kode seperti berikut pada head halaman AMP:</p> <pre><code class="language-html">&lt;head>
  &lt;link rel="canonical" href="alamat-halaman-asli">&lt;/link>
&lt;/head>
</code></pre> <p>Dan kode berikut pada halaman aslinya:</p> <pre><code class="language-html">&lt;head>
  &lt;link rel="amphtml" href="alamat-halaman-amp">&lt;/link>
&lt;/head>
</code></pre> <p>Untuk membuat dua kode diatas kita bisa menambahkan pada bagian <code>head()</code> pada file .vue dari halaman kita, seperti contoh berikut pada halaman AMP:</p> <pre><code class="language-javascript">export default {
  head () {
    const url = `${this.productionUrl}/${this.meta.slug}`
    return {
      link: [
        { hid: 'canonical', rel: 'canonical', href: url }
      ]
    }
  }
}
</code></pre> <p>Dan berikut yang saya sematkan pada halaman aslinya:</p> <pre><code class="language-javascript">export default {
  head () {
    const ampUrl = `${this.productionUrl}/amp/${this.meta.slug}`
    return {
      link: [
        { hid: 'amphtml', rel: 'amphtml', href: ampUrl }
      ]
    }
  }
}
</code></pre> <h3>9. Menambahkan Google Analytics</h3> <p>Untuk menambahkan Google Analytics pada halaman AMP memang sedikit berbeda dengan halaman biasa. Secara mudahnya, menambahkan Google Analytics bisa dilakukan dengan menambahkan skrip eksternal berikut:</p> <pre><code class="language-html">&lt;script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js">&lt;/script>
</code></pre> <p>Serta menempatkan kode sederhana untuk melacak <em>page view</em> seperti berikut:</p> <pre><code class="language-html">&lt;amp-analytics type='googleanalytics'>
  &lt;script type='application/json'>
    {
      "vars": {
        "account": "UA-12345678-X"
      },
      "triggers": {
        "trackPageview": {
          "on": "visible",
          "request": "pageview"
        }
      }
    }
  &lt;/script>
&lt;/amp-analytics>
</code></pre> <p>Untuk projek kita, kita bisa menyisipkan kode ini pada skrip <code>ampify</code> kita dengan sedikit perubahan seperti berikut:</p> <pre><code class="language-javascript">const ampScript = `&lt;script async src="https://cdn.ampproject.org/v0.js">&lt;/script>
&lt;script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js">&lt;/script>`
</code></pre> <p>Kode di atas digunakan untuk menyisipkan skrip analytics yang dibutuhkan. Dan berikutnya kita akan menyisipkan skrip tracking sebelum tag penutup <code>&lt;/body></code>, seperti contoh berikut:</p> <pre><code class="language-javascript">// Add AMP analytics
html = html.replace('&lt;/body>',
`&lt;amp-analytics type='googleanalytics'>
    &lt;script type='application/json'>
      {
        "vars": {
          "account": "UA-12345678-X"
        },
        "triggers": {
          "trackPageview": {
            "on": "visible",
            "request": "pageview"
          }
        }
      }
    &lt;/script>
  &lt;/amp-analytics>
&lt;/body>`)
</code></pre> <h2>Test Validasi Halaman AMP</h2> <p>Setelah proses selesai dan kalian sudah menghasilkan berkas statis yang mendukung AMP, jangan lupa untuk mengecek validasi dari halaman tersebut. Ada beberapa alternatif yang bisa kalian gunakan untuk melakukan test terhadap validasi AMP, diantaranya</p> <ul><li><a href="https://search.google.com/test/amp">https://search.google.com/test/amp</a></li> <li><a href="https://validator.ampproject.org/">https://validator.ampproject.org/</a></li></ul> <p>Untuk hasil test blog saya sendiri kalian bisa lihat di beberapa tautan berikut:</p> <ul><li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp">Halaman Beranda</a></li> <li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp%2Fabout">Halaman Tentang</a></li> <li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp%2Feslint-formatter-html-extended%2F">Halaman Post Tanpa Gambar</a></li> <li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp%2Ftasting-reasonml-for-react%2F">Halaman Post Dengan Gambar</a></li></ul> <h2>Repositori hasil belajar</h2> <p><a href="https://github.com/mazipan/blog-2.0">https://github.com/mazipan/blog-2.0 ↗️</a></p> <h3>Demikian artikel kali ini, semoga bermanfaat...</h3></div> <div><a href="/" class="nuxt-link-active">
    🏠 Back to Home
  </a> <span class="dot"> • </span> <a target="_blank" rel="noopener" title="Edit in Github" href="https://github.com/mazipan/blog-2.0/edit/master/contents/published/generate-amp-pages-in-nuxtjs/index.md">
    📝 Edit in Github
  </a></div></div> <hr> <div class="pages__footer">
    🚨Do you like this article? help me to share to your followers.
  </div></section></section> <hr> <footer class="footer clearfix"><span>Copyright © 2019 by</span> <a href="http://github.com/mazipan" title="Github" target="_blank" rel="noopener">Irfan Maulana</a> <br> <span>See source code in </span> <a href="https://github.com/mazipan/blog-2.0" title="Github Blog 2.0" target="_blank" rel="noopener">Github</a></footer></div></div></div><noscript>This website requires JavaScript.</noscript>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https://www.mazipan.xyz",
        "name": "Irfan Maulana",
        "author": "Irfan Maulana",
        "image": "https://www.mazipan.xyz/icon.png",
        "description": "@mazipan | A personal blog by Irfan Maulana",
        "sameAs": [ "https://www.facebook.com/mazipanneh", "https://instagram.com/maz_ipan", "https://twitter.com/Maz_Ipan", "https://id.linkedin.com/in/mazipan", "https://www.slideshare.net/IrfanMaulana21", "https://github.com/mazipan"
        ]
      }
    </script>
  <amp-analytics type='googleanalytics'>
    <script type='application/json'>
      {
        "vars": {
          "account": "UA-25065548-6"
        },
        "triggers": {
          "trackPageview": {
            "on": "visible",
            "request": "pageview"
          }
        }
      }
    </script>
  </amp-analytics>
</body>
</html>
